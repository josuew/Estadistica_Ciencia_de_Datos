---
title: "Analisis Estadistico Exploratorio"
author: "Josue Emmanuel Jauregui Arvilla"
date: "28 de Octubre de 2025"
output: html_document
---

# Introduccion
El presente reporte analiza los datos de dengue en Mexico correspondientes al anio 2020 para los estados de Michoacan, Colima, Nayarit, Jalisco y Guerrero con el objetivo de mostrar algunas medidas de tendencia central,

## Cargar libreria para la lectura de archivos xlsx en R
```{r}
# readxl es una libreria de R que nos permite leer el archivos con extension .xlsx, esto nos ayuda para poder
# realizar lecturas de sheets (tabs en excel)
library(readxl)

# lubridate es una libreria de R que nos permite trabajar con fechas, los cuales podemos extraer dia, mes y anio de alguna columna que contenga tipos de datos Date
library(lubridate)

# car es una libreria de R que nos permite generar graficos de densidad
library(car)
```

## Preparacion de Datos de Dengue
En esta sección se procede a la carga de los datos de dengue en México y a su integración con los catálogos de entidades federativas, municipios y sexo.

### Carga de Datos de Dengue
Al momento de cargar los datos de dengue, se observa que el archivo contiene 550,247 registros. Es importante mencionar que este archivo contiene los datos en crudo, es necesario realizar la integracion con los catalogos de entidades federativas, municipios y sexo para mejorar la visualizacion de los datos.
```{r}
# Carga de datos de dengue en México
dengue <- read.csv("/Users/jaureperro/PycharmProjects/Estadistica_Ciencia_de_Datos/data/dengue_abierto.csv")
length(dengue$ID_REGISTRO)
```

### Integracion Entidades Federativas
Para integrar las entidades federativas a nuestra tabla de dengue, es necesario cargar el archivo de catalogo de entidades federativas. Para ello se utiliza la libreria readxl que nos permite cargar el sheet de catalogo de entidades federativas, una vez cargado el archivo, se realiza la integracion de los datos de dengue en la columna entidad_res con el catalogo de entidades federativas. Esto nos permite obtener el nombre de la entidad federativa correspondiente al numero de registro de la tabla dengue en la columna entidad_res.
```{r}
# Cargamos el archivo cat_dengue.xlsx y seleccionamos el sheet "CATÁLOGO ENTIDAD"
catalogo_entidad <- read_excel("/Users/jaureperro/PycharmProjects/Estadistica_Ciencia_de_Datos/data/cat_dengue.xlsx", sheet = "CATÁLOGO ENTIDAD")
catalogo_entidad
```

Dentro podemos observar que la columna CLAVE_ENTIDAD es de tipo character, por lo que es necesario convertirla a numerica mediante el uso de la funcion as.numeric el cual nos permite realizar la convercion de un tipo de dato character a numeric:
```{r}
catalogo_entidad$CLAVE_ENTIDAD <- as.numeric(catalogo_entidad$CLAVE_ENTIDAD) # conversion a numerico
sapply(catalogo_entidad, class)
```

Realizamos la relacion de la columna CLAVE_ENTIDAD con la columna ENTIDAD_RES de nuestra tabla de dengue, la cual al hacer la union nos permite obtener el nombre de la entidad federativa correspondiente al numero de registro de la tabla dengue en la columna entidad_res:

```{r}
# Union de la columna CLAVE_ENTIDAD con la columna ENTIDAD_RES de la tabla dengue
dengue2 <- merge(dengue,catalogo_entidad, by.x = "ENTIDAD_RES", by.y = "CLAVE_ENTIDAD")
dengue2[1,]
```

### Integracion Catalogo Sexo
Para integrar descripciones de sexo a nuestra tabla de dengue, es necesario cargar el archivo de catalogo de sexo. Nuevamente haremos uso de la libreria readxl que nos permite cargar el sheet de catalogo de sexo, una vez cargado el archivo, se realiza la integracion de los datos de dengue en la columna SEXO con el catalogo de sexo de la columna CLAVE. Esto nos permite obtener la descripcion de correspondiente al sexo de la tabla dengue en la columna sexo en vez de tomar numeros como 1 o 2.

```{r}
catalogo_sexo <- read_excel("/Users/jaureperro/PycharmProjects/Estadistica_Ciencia_de_Datos/data/cat_dengue.xlsx", sheet = "CATÁLOGO SEXO")
sapply(catalogo_sexo, class)
```


En este caso podras notar que la columna CLAVE es de tipo numerico, por lo que no es necesario realizar la convercion de un tipo de dato character a numerica, aqui procederemos a realizar la union de la columna CLAVE con la columna SEXO de la tabla dengue (es importante mencionar que se tomaron los datos de dengue2 ya que contiene los datos de dengue integrados con el catalogo de entidades federativas):

```{r}
# Union de la columna CLAVE con la columna SEXO de la tabla dengue2
dengue3 <- merge(dengue2, catalogo_sexo, by.x = "SEXO", by.y = "CLAVE")
dengue3[1,]
```

### Integracion Catalogo Municipio
Para integrar los municipio a nuestra tabla de dengue, es necesario cargar el archivo de catalogo municipio. Nuevamente haremos uso de la libreria readxl que nos permite cargar el sheet de catalogo de munixipio, una vez cargado el archivo, se realiza la integracion de los datos de dengue en la columna MUNICIPIO_RES con el catalogo de municipio de la columna CLAVE_MUNICIPIO y CLAVE_ENTIDAD.

```{r}
catalogo_municipio <- read_excel("/Users/jaureperro/PycharmProjects/Estadistica_Ciencia_de_Datos/data/cat_dengue.xlsx", sheet = "CATÁLOGO MUNICIPIO")
sapply(catalogo_municipio, class)
```

Al momento de obtener los tipos de dato de las columnas del catalogo de municipio, podemos observar que la columna CLAVE_MUNICIPIO y CLAVE_ENTIDAD son de tipo character, por lo que es necesario convertirlas a numerica mediante el uso de la funcion as.numeric el cual nos permite realizar la convercion de un tipo de dato character a numerico, pero si nos fijamos en la columna CLAVE_ENTIDAD, podemos observar que tenemos en la tabla 3 registros (USA, ALTN, OTROS), los cuales si hacemos la conversion a numerica nos lo convertiria a NaN, para evitar el mensaje de coercion, es necesario sobreescribir dentro de esos valores, sus numeros correspondientes a las entidades federativas dentro de la sheet catalogo entidad:

```{r}
# Se asignan los valores que corresponden de CATALOGO ENTIDAD para estas CLAVES de Entidad
catalogo_municipio[catalogo_municipio$CLAVE_ENTIDAD == "USA", 3] <- "33"
catalogo_municipio[catalogo_municipio$CLAVE_ENTIDAD == "ALTN", 3] <- "34"
catalogo_municipio[catalogo_municipio$CLAVE_ENTIDAD == "OTROS", 3] <- "35"

# Realiza la conversion numerica de CLAVE_ENTIDAD y CLAVE_MUNICIPIO a numerico
catalogo_municipio$CLAVE_ENTIDAD <- as.numeric(catalogo_municipio$CLAVE_ENTIDAD)
catalogo_municipio$CLAVE_MUNICIPIO <- as.numeric(catalogo_municipio$CLAVE_MUNICIPIO)
```

Una vez realizada la convercion de los tipos de dato de las columnas del catalogo de municipio, procederemos a realizar la union de la columna CLAVE_ENTIDAD con la columna CLAVE_MUNICIPIO de la tabla dengue3:

```{r}
dengue4 <- merge(x = dengue3, y = catalogo_municipio, by.x = c("ENTIDAD_RES","MUNICIPIO_RES"), by.y = c("CLAVE_ENTIDAD", "CLAVE_MUNICIPIO"), sort=FALSE)
dengue4[1,]
```

### Agregar columna de dia, meses, anios de registro
Para agregar una columna de meses de registro a nuestra tabla de dengue, es necesario cargar la libreria lubridate que nos permite trabajar con fechas.

```{r}

Sys.setlocale("LC_TIME", "es_ES.UTF-8")
# Realizamos la conversion de la columna FECHA_SIGN_SINTOMAS a el formato %d/%m/%y
dengue4$FECHA_SIGN_SINTOMAS <- as.Date(dengue4$FECHA_SIGN_SINTOMAS, tryFormats = "%d/%m/%y")

# Creamos una columna que se llama DIA_SIGN_SINTOMAS que contiene el dia del registro de la columna FECHA_SIGN_SINTOMAS
dengue4$DIA_SIGN_SINTOMAS <- day(dengue4$FECHA_SIGN_SINTOMAS)
# Creamos una columna que se llama MES_SIGN_SINTOMAS que contiene el mes del registro de la columna FECHA_SIGN_SINTOMAS
dengue4$MES_SIGN_SINTOMAS <- month(dengue4$FECHA_SIGN_SINTOMAS)
dengue4$MES_SIGN_SINTOMAS_DESC <- toupper(month(dengue4$FECHA_SIGN_SINTOMAS, label = TRUE, abbr = FALSE))
# Creamos una columna que se llama ANIO_SIGN_SINTOMAS que contiene el anio del registro de la columna FECHA_SIGN_SINTOMAS
dengue4$ANIO_SIGN_SINTOMAS <- year(dengue4$FECHA_SIGN_SINTOMAS)
dengue4[1,]

```

### Tabla de Dengue
Despues de realizar todas las operaciones anteriores, podemos observar que la tabla de dengue contiene 550,247 registros al igual que al inicio, solo que ahora contiene las columnas que nos permiten saber la entidad federativa, municipio, sexo, dia, mes y anio de registro. Para mantener un nombre de variable claro, se renombro la tabla de dengue4 a tabla_dengue:

```{r}
tabla_dengue <- dengue4
length(tabla_dengue$ID_REGISTRO)
```


## Obtencion de los registros de las entidades federativas seleccionadas
Con el fin de realizar los análisis de este reporte, se extrajo una submuestra de los registros provenientes de las entidades federativas de Michoacán, Colima, Nayarit, Jalisco y Guerrero. Esta submuestra incluye 226,460 registros, lo que representa aproximadamente el 41% del total de 550,247 registros de la población estudiada.

Los datos se filtran de la siguiente manera:

```{r}
# Realizamos un filtro para obtener las entidades de "MICHOACÁN DE OCAMPO","COLIMA","NAYARIT","JALISCO","GUERRERO" de nuestra tabla dengue
estados_seleccionados <- tabla_dengue$ENTIDAD_FEDERATIVA %in% c("MICHOACÁN DE OCAMPO","COLIMA","NAYARIT","JALISCO","GUERRERO")

# Crearemos la variable info_estados_seleccionados contiene los registros de las entidades federativas anteriormente mencionadas
info_estados_seleccionados <- tabla_dengue[estados_seleccionados,]
paste("Cantidad de registros de las entidades filtradas: ", length(info_estados_seleccionados$ID_REGISTRO))
```

## Análisis de Tendencia Central y Dispersión
Una vez filtrados los datos, se procede al análisis de una medida de tendencia central y una medida de dispersión: la media y la desviación estándar de los pacientes reportados en las entidades federativas seleccionadas.

```{r}
# Creamos la funcion media_y_desviacion_estandar que como su nombre lo indica, obtiene la media y la desviación estándar
media_y_desviacion_estandar <- function (x){
  c(media = mean(x), desviacion_estandar = sd(x))
}

# Agrupamos la relación de la edad de los pacientes por la entidad federativa y el sexo mediante el uso de la función aggregate con los datos filtrados
media_edades_confirmados <- aggregate(EDAD_ANOS ~ ENTIDAD_FEDERATIVA + `DESCRIPCIÓN`, FUN=media_y_desviacion_estandar, data = info_estados_seleccionados)

# Ordenamos de manera ascendente los nombres de las entidades federativas
media_edades_confirmados <- media_edades_confirmados[order(media_edades_confirmados$ENTIDAD_FEDERATIVA),]

# Se fuerza la conversión del objeto media_edades_confirmados a un data frame
df_edades_confirmadas <- do.call(data.frame, media_edades_confirmados)

# Se renombran las columnas para tener nombres acordes al análisis
names(df_edades_confirmadas) <- c(
  "Entidad Federativa",
  "Sexo",
  "Media",
  "Desviación Estándar"
)
df_edades_confirmadas
```

De los datos presentados se observa que la edad promedio de los registros analizados se encuentra entre 22 y 34 años. Asimismo, se aprecia que en todas las entidades federativas consideradas, las mujeres presentan una media de edad superior a la de los hombres. Esto sugiere que, en promedio, las mujeres diagnosticadas tienden a ser ligeramente mayores que los hombres dentro de los mismos estados.

En cuanto a la desviación estándar, esta se sitúa entre 17 y 19 años, lo cual refleja una amplia dispersión en las edades. Dicho valor indica que la muestra incluye personas de diferentes edades, desde niños y adultos jóvenes hasta adultos mayores.

## Gráfico de Caja
Para reforzar la interpretación de los resultados anteriores, se elaboró un diagrama de cajas (boxplot) que muestra la distribución de edades por entidad federativa y sexo.

```{r boxplot_edad, fig.width=11, fig.height=7, dpi=300}
par(mar = c(5, 14, 4, 8), xpd = NA)
boxplot(EDAD_ANOS ~ `DESCRIPCIÓN` + ENTIDAD_FEDERATIVA,
        main = "Distribución de Edad por Entidad Federativa y Sexo",
        xlab = "Edad (años)",
        ylab = "",
        data = info_estados_seleccionados,
        horizontal = TRUE,
        las = 1,
        col = c("lightblue", "lightpink"),
        names = rep(c("H", "M"), 5),
        at = c(1, 2, 4, 5, 7, 8, 10, 11, 13, 14))

axis(2, at = c(1.5, 4.5, 7.5, 10.5, 13.5),
     labels = sort(unique(info_estados_seleccionados$ENTIDAD_FEDERATIVA)),
     las = 1, tick = FALSE, line = 1)
legend("topright",
       legend = c("Hombre", "Mujer"),
       fill = c("lightblue", "lightpink"),
       inset = c(-0.25, 0),   # mueve más hacia fuera
       xpd = NA,              # permite dibujar fuera de los márgenes del plot
       bty = "n")             # sin borde para verse más limpio
```

Podemos notar que en la mayoría de los casos, se observa que las mujeres presentan una mediana de edad superior a la de los hombres, lo cual coincide con el análisis previo y sugiere que, en promedio, las mujeres diagnosticadas tienden a ser ligeramente mayores que los hombres en los mismos estados.

El estado de Guerrero presenta un mayor número de valores atípicos (outliers), lo que indica la existencia de registros correspondientes a personas en edades más avanzadas, es decir, adultos mayores. Por otro lado, Jalisco muestra los promedios y medianas de edad más altos tanto en hombres como en mujeres, mientras que Guerrero concentra los promedios más bajos para ambos sexos, lo que sugiere que la población diagnosticada en esta entidad es, en general, más joven en comparación con las demás entidades federativas.

## Análisis gráfico de densidad
Otra manera de interpretar los datos es mediante un gráfico de densidad que muestra la distribución de edades por entidad federativa y sexo.

```{r}

colores_estados <- c(
  "COLIMA" = "black",
  "GUERRERO" = "blue",
  "JALISCO" = "magenta",
  "MICHOACÁN DE OCAMPO" = "cyan",
  "NAYARIT" = "orange"
)


densityPlot(
  info_estados_seleccionados$EDAD_ANOS ~ as.factor(info_estados_seleccionados$ENTIDAD_FEDERATIVA),
  main = "Distribución de la Edad por Entidad Federativa",
  xlab = "", ylab = "", col = colores_estados,
  legend = list(title = "Entidad Federativa", cex = 0.8)
)
mtext("Edad (años)", side = 1, line = 2.5, cex = 1.1)
mtext("Densidad", side = 2, line = 2.5, cex = 1.1)
```

El gráfico de densidad permite observar que el dengue durante el año 2020 afectó principalmente a personas jóvenes, especialmente en el rango de 10 a 30 años.
Sin embargo, la presencia de colas largas hacia la derecha indica que también se registraron casos en edades más avanzadas.
Entre los estados analizados, Guerrero presenta la población más joven afectada, mientras que Jalisco y Colima muestran una distribución más amplia, lo que refleja una afectación más homogénea entre jóvenes y adultos.

## Mayor cantidad de casos de cada estado y hacer grafico de densidad
Para determinar el municipio con mayor cantidad de casos de cada estado, se realiza un conteo de los registros de la siguiente manera:

```{r}

# Se realiza un conteo de registros por entidad federativa y municipio
conteo_registros_municipio <- aggregate(info_estados_seleccionados$ID_REGISTRO ~ info_estados_seleccionados$ENTIDAD_FEDERATIVA + info_estados_seleccionados$MUNICIPIO , FUN = length)

# Se renombran la columnas para que contengan nombres mas cortos
colnames(conteo_registros_municipio) <- c("Estado", "Municipio", "Registros")

# Se obtiene la cantidad de registros mas alto de cada estado
maximos_por_estado <- do.call(rbind, by(conteo_registros_municipio, conteo_registros_municipio$Estado, function(df) {
  df[which.max(df$Registros),]
}))
rownames(maximos_por_estado) <- NULL

# Se obtienen los registros de los estados y municipios con mas registros
info_municipios_max <- info_estados_seleccionados[
  paste(info_estados_seleccionados$ENTIDAD_FEDERATIVA, info_estados_seleccionados$MUNICIPIO) %in%
  paste(maximos_por_estado$Estado, maximos_por_estado$Municipio),
]

# Se genera el gráfico de densidad en base a estos municipios y estados con mas casos de registro
densityPlot(info_municipios_max$EDAD_ANOS ~ as.factor(info_municipios_max$MUNICIPIO),
            main = "Distribución de Edad en Municipios con Mayores Casos por Estado",
            xlab = "", ylab = "",
            legend = list(title = "Municipio"))

mtext("Edad (años)", side = 1, line = 2.5, cex = 1.1)
mtext("Densidad", side = 2, line = 2.5, cex = 1.1)
```


# Mostrar un grafico de barras, de cada estado, donde muestre la frecuencia de registro
# de nuevos casos de los meses enero a septiembre.

```{r}

registros_jalisco_meses <- info_estados_seleccionados[info_estados_seleccionados$ENTIDAD_FEDERATIVA == "JALISCO",]
table(registros_jalisco$ENTIDAD_FEDERATIVA)
registros_jalisco[length(registros_jalisco$ID_REGISTRO),]
frecuencia_jalisco <- aggregate(ID_REGISTRO ~ MES_SIGN_SINTOMAS + MES_SIGN_SINTOMAS_DESC, FUN=length, data = registros_jalisco_meses)
frecuencia_jalisco <- frecuencia_jalisco[order(frecuencia_jalisco$MES_SIGN_SINTOMAS), ]

par(mar = c(8, 6, 4, 2))
barplot(
  frecuencia_jalisco$ID_REGISTRO,
  names.arg = frecuencia_jalisco$MES_SIGN_SINTOMAS_DESC,
  xlab = "",
  ylab = "",
  cex.names = 0.9,    # Tamaño del texto de los nombres
  cex.axis = 0.9,     # Tamaño del texto de los ejes
  las = 2)

# Títulos de los ejes y gráfico (con separación ajustada)
mtext("Meses", side = 1, line = 5, cex = 1.1)      # Eje X (más abajo)
mtext("Registros", side = 2, line = 4, cex = 1.1)  # Eje Y (más a la izquierda)
title(main = "Distribución de los registros por mes en el estado de Jalisco", line = 1)
```

```{r}
registros_colima <- info_estados_seleccionados[info_estados_seleccionados$MES_SIGN_SINTOMAS >= 1 & info_estados_seleccionados$MES_SIGN_SINTOMAS <= 9,]
frecuencia_colima <- aggregate(ID_REGISTRO ~ MES_SIGN_SINTOMAS + MES_SIGN_SINTOMAS_DESC, FUN=length, data = registros_colima)
frecuencia_jalisco <- frecuencia_jalisco[order(frecuencia_jalisco$MES_SIGN_SINTOMAS), ]

par(mar = c(8, 6, 4, 2))
barplot(
  frecuencia_jalisco$ID_REGISTRO,
  names.arg = frecuencia_jalisco$MES_SIGN_SINTOMAS_DESC,
  xlab = "",
  ylab = "",
  cex.names = 0.9,    # Tamaño del texto de los nombres
  cex.axis = 0.9,     # Tamaño del texto de los ejes
  las = 2)

# Títulos de los ejes y gráfico (con separación ajustada)
mtext("Meses", side = 1, line = 5, cex = 1.1)      # Eje X (más abajo)
mtext("Registros", side = 2, line = 4, cex = 1.1)  # Eje Y (más a la izquierda)
title(main = "Distribución de los registros por mes en el estado de Jalisco", line = 1)
```
