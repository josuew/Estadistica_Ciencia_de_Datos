---
title: "Analisis Estadistico Exploratorio"
author: "Josue Emmanuel Jauregui Arvilla"
date: "28 de Octubre de 2025"
output: html_document
---

# Introduccion
El presente reporte analiza los datos de dengue en Mexico correspondientes al anio 2020 para los estados de Michoacan, Colima, Nayarit, Jalisco y Guerrero con el objetivo de mostrar algunas medidas de tendencia central,

## Cargar libreria para la lectura de archivos xlsx en R
```{r}
# readxl es una libreria de R que nos permite leer el archivos con extension .xlsx, esto nos ayuda para poder
# realizar lecturas de sheets (tabs en excel)
library(readxl)

# lubridate es una libreria de R que nos permite trabajar con fechas, los cuales podemos extraer dia, mes y anio de alguna columna que contenga tipos de datos Date
library(lubridate)

# car es una libreria de R que nos permite generar graficos de densidad
library(car)
```

## Preparacion de Datos de Dengue
En esta sección se procede a la carga de los datos de dengue en México y a su integración con los catálogos de entidades federativas, municipios y sexo.

### Carga de Datos de Dengue
Al momento de cargar los datos de dengue, se observa que el archivo contiene 550,247 registros. Es importante mencionar que este archivo contiene los datos en crudo, es necesario realizar la integracion con los catalogos de entidades federativas, municipios y sexo para mejorar la visualizacion de los datos.
```{r}
# Carga de datos de dengue en México
dengue <- read.csv("/Users/jaureperro/PycharmProjects/Estadistica_Ciencia_de_Datos/data/dengue_abierto.csv")
length(dengue$ID_REGISTRO)
```

### Integracion Entidades Federativas
Para integrar las entidades federativas a nuestra tabla de dengue, es necesario cargar el archivo de catalogo de entidades federativas. Para ello se utiliza la libreria readxl que nos permite cargar el sheet de catalogo de entidades federativas, una vez cargado el archivo, se realiza la integracion de los datos de dengue en la columna entidad_res con el catalogo de entidades federativas. Esto nos permite obtener el nombre de la entidad federativa correspondiente al numero de registro de la tabla dengue en la columna entidad_res.
```{r}
# Cargamos el archivo cat_dengue.xlsx y seleccionamos el sheet "CATÁLOGO ENTIDAD"
catalogo_entidad <- read_excel("/Users/jaureperro/PycharmProjects/Estadistica_Ciencia_de_Datos/data/cat_dengue.xlsx", sheet = "CATÁLOGO ENTIDAD")
catalogo_entidad
```

Dentro podemos observar que la columna CLAVE_ENTIDAD es de tipo character, por lo que es necesario convertirla a numerica mediante el uso de la funcion as.numeric el cual nos permite realizar la convercion de un tipo de dato character a numeric:
```{r}
catalogo_entidad$CLAVE_ENTIDAD <- as.numeric(catalogo_entidad$CLAVE_ENTIDAD) # conversion a numerico
sapply(catalogo_entidad, class)
```

Realizamos la relacion de la columna CLAVE_ENTIDAD con la columna ENTIDAD_RES de nuestra tabla de dengue, la cual al hacer la union nos permite obtener el nombre de la entidad federativa correspondiente al numero de registro de la tabla dengue en la columna entidad_res:

```{r}
# Union de la columna CLAVE_ENTIDAD con la columna ENTIDAD_RES de la tabla dengue
dengue2 <- merge(dengue,catalogo_entidad, by.x = "ENTIDAD_RES", by.y = "CLAVE_ENTIDAD")
dengue2[1,]
```

### Integracion Catalogo Sexo
Para integrar descripciones de sexo a nuestra tabla de dengue, es necesario cargar el archivo de catalogo de sexo. Nuevamente haremos uso de la libreria readxl que nos permite cargar el sheet de catalogo de sexo, una vez cargado el archivo, se realiza la integracion de los datos de dengue en la columna SEXO con el catalogo de sexo de la columna CLAVE. Esto nos permite obtener la descripcion de correspondiente al sexo de la tabla dengue en la columna sexo en vez de tomar numeros como 1 o 2.

```{r}
catalogo_sexo <- read_excel("/Users/jaureperro/PycharmProjects/Estadistica_Ciencia_de_Datos/data/cat_dengue.xlsx", sheet = "CATÁLOGO SEXO")
sapply(catalogo_sexo, class)
```


En este caso podras notar que la columna CLAVE es de tipo numerico, por lo que no es necesario realizar la convercion de un tipo de dato character a numerica, aqui procederemos a realizar la union de la columna CLAVE con la columna SEXO de la tabla dengue (es importante mencionar que se tomaron los datos de dengue2 ya que contiene los datos de dengue integrados con el catalogo de entidades federativas):

```{r}
# Union de la columna CLAVE con la columna SEXO de la tabla dengue2
dengue3 <- merge(dengue2, catalogo_sexo, by.x = "SEXO", by.y = "CLAVE")
dengue3[1,]
```

### Integracion Catalogo Municipio
Para integrar los municipio a nuestra tabla de dengue, es necesario cargar el archivo de catalogo municipio. Nuevamente haremos uso de la libreria readxl que nos permite cargar el sheet de catalogo de munixipio, una vez cargado el archivo, se realiza la integracion de los datos de dengue en la columna MUNICIPIO_RES con el catalogo de municipio de la columna CLAVE_MUNICIPIO y CLAVE_ENTIDAD.

```{r}
catalogo_municipio <- read_excel("/Users/jaureperro/PycharmProjects/Estadistica_Ciencia_de_Datos/data/cat_dengue.xlsx", sheet = "CATÁLOGO MUNICIPIO")
sapply(catalogo_municipio, class)
```

Al momento de obtener los tipos de dato de las columnas del catalogo de municipio, podemos observar que la columna CLAVE_MUNICIPIO y CLAVE_ENTIDAD son de tipo character, por lo que es necesario convertirlas a numerica mediante el uso de la funcion as.numeric el cual nos permite realizar la convercion de un tipo de dato character a numerico, pero si nos fijamos en la columna CLAVE_ENTIDAD, podemos observar que tenemos en la tabla 3 registros (USA, ALTN, OTROS), los cuales si hacemos la conversion a numerica nos lo convertiria a NaN, para evitar el mensaje de coercion, es necesario sobreescribir dentro de esos valores, sus numeros correspondientes a las entidades federativas dentro de la sheet catalogo entidad:

```{r}
# Se asignan los valores que corresponden de CATALOGO ENTIDAD para estas CLAVES de Entidad
catalogo_municipio[catalogo_municipio$CLAVE_ENTIDAD == "USA", 3] <- "33"
catalogo_municipio[catalogo_municipio$CLAVE_ENTIDAD == "ALTN", 3] <- "34"
catalogo_municipio[catalogo_municipio$CLAVE_ENTIDAD == "OTROS", 3] <- "35"

# Realiza la conversion numerica de CLAVE_ENTIDAD y CLAVE_MUNICIPIO a numerico
catalogo_municipio$CLAVE_ENTIDAD <- as.numeric(catalogo_municipio$CLAVE_ENTIDAD)
catalogo_municipio$CLAVE_MUNICIPIO <- as.numeric(catalogo_municipio$CLAVE_MUNICIPIO)
```

Una vez realizada la convercion de los tipos de dato de las columnas del catalogo de municipio, procederemos a realizar la union de la columna CLAVE_ENTIDAD con la columna CLAVE_MUNICIPIO de la tabla dengue3:

```{r}
dengue4 <- merge(x = dengue3, y = catalogo_municipio, by.x = c("ENTIDAD_RES","MUNICIPIO_RES"), by.y = c("CLAVE_ENTIDAD", "CLAVE_MUNICIPIO"), sort=FALSE)
dengue4[1,]
```

### Agregar columna de dia, meses, anios de registro
Para agregar una columna de meses de registro a nuestra tabla de dengue, es necesario cargar la libreria lubridate que nos permite trabajar con fechas.

```{r}
# Realizamos la conversion de la columna FECHA_SIGN_SINTOMAS a el formato %d/%m/%y
dengue4$FECHA_SIGN_SINTOMAS <- as.Date(dengue4$FECHA_SIGN_SINTOMAS, tryFormats = "%d/%m/%y")

# Creamos una columna que se llama DIA_SIGN_SINTOMAS que contiene el dia del registro de la columna FECHA_SIGN_SINTOMAS
dengue4$DIA_SIGN_SINTOMAS <- day(dengue4$FECHA_SIGN_SINTOMAS)
# Creamos una columna que se llama MES_SIGN_SINTOMAS que contiene el mes del registro de la columna FECHA_SIGN_SINTOMAS
dengue4$MES_SIGN_SINTOMAS <- month(dengue4$FECHA_SIGN_SINTOMAS)
# Creamos una columna que se llama ANIO_SIGN_SINTOMAS que contiene el anio del registro de la columna FECHA_SIGN_SINTOMAS
dengue4$ANIO_SIGN_SINTOMAS <- year(dengue4$FECHA_SIGN_SINTOMAS)
dengue4[1,]

```

### Agregar descripcion de pacientes
```{r}
catalogo_estatus_caso <- read_excel("/Users/jaureperro/PycharmProjects/Estadistica_Ciencia_de_Datos/data/cat_dengue.xlsx", sheet = "CATÁLOGO ESTATUS_CASO")
sapply(catalogo_estatus_caso, class)
```


```{r}
dengue5 <- merge(x = dengue4, y = catalogo_estatus_caso, by.x = "ESTATUS_CASO", by.y = "CLAVE", sort=FALSE)
dengue5[1,]
```


### Tabla de Dengue
Despues de realizar todas las operaciones anteriores, podemos observar que la tabla de dengue contiene 550,247 registros al igual que al inicio, solo que ahora contiene las columnas que nos permiten saber la entidad federativa, municipio, sexo, dia, mes y anio de registro. Para mantener un nombre de variable claro, se renombro la tabla de dengue4 a tabla_dengue:

```{r}
tabla_dengue <- dengue5
length(tabla_dengue$ID_REGISTRO)
```


## Obtencion de los registros de las entidades federativas seleccionadas
Con el fin de realizar los análisis de este reporte, se extrajo una submuestra de los registros provenientes de las entidades federativas de Michoacán, Colima, Nayarit, Jalisco y Guerrero. Esta submuestra incluye 226,460 registros, lo que representa aproximadamente el 41% del total de 550,247 registros de la población estudiada.

```{r}
# Realizamos un filtro para obtener las entidades de "MICHOACÁN DE OCAMPO","COLIMA","NAYARIT","JALISCO","GUERRERO" de nuestra tabla dengue
estados_dengue <- tabla_dengue$ENTIDAD_FEDERATIVA %in% c("MICHOACÁN DE OCAMPO","COLIMA","NAYARIT","JALISCO","GUERRERO")

# Crearemos la variable info_estados_dengue el cual solo contiene los registros de los estados anteriormente mencionados
info_estados_dengue <- tabla_dengue[estados_dengue,]
length(info_estados_dengue$ID_REGISTRO)
```

## Analisis de Tendencia Central

### Analisis de Edad Promedio y Desviacion Estandar
Para este punto nos importa obtener la media y desviacion estandar de aquellos pacientes reportados en las entidades federativas seleccionadas. Para ello, filtraremos aquellos pacientes confirmados:
```{r}
info_estados_dengue_confirmados <- info_estados_dengue[info_estados_dengue$`DESCRIPCIÓN.y` == "CONFIRMADO",]

# Creamos la funcion que nos permite obtener la media y la desviacion estandar
media_y_desviacion_estandar <- function (x){
  c(media = mean(x), desviacion_estandar = sd(x))
}

# Obtenemos
media_edades_confirmados <- aggregate(EDAD_ANOS ~ ENTIDAD_FEDERATIVA + `DESCRIPCIÓN.x`, FUN=media_y_desviacion_estandar, data = info_estados_dengue_confirmados)

media_edades_confirmados <- media_edades_confirmados[order(media_edades_confirmados$ENTIDAD_FEDERATIVA),]
df_edades_confirmadas <- do.call(data.frame, media_edades_confirmados)
names(df_edades_confirmadas) <- c(
  "entidad_federativa",
  "descripcion",
  "media",
  "desviacion_estandar"
)
df_edades_confirmadas
```

De lo anterior podemos ver que las medias de edad de los pacientes confirmados estan entre 21 y 34 anios, lo que sugiere que de los casos confirmados afectan principalmente adultos jovenes en las entidades federativas seleccionadas, en cuanto a la desviacion estandar, podemos notar una amplia variabilidad en edades ya que oscila entre 16 y 19 anos dentro de cada entidad federativa tanto edades en menores como mayores. En general, las mujeres presentan una media de edad ligeramente mayor a los hombres.

## Analisis Edad Promedio por Sexo
Para reforzar la interpretacion de los resultados anteriores, se realizo un grafico tipo box, donde podemos ver que la distribucion de edades es bastante similar, donde en la mayoria de los casos las mujeres muestran mayormente cuentan con una mediana mayor a los hombres, lo que sugiere que en promedio las mujeres diagnosticadas tienden a ser ligeramente mayores que los hombres en los mismos estados. Ademas podemos notar que en Jalisco es el estado con mayor promedio de edades tanto en hombres como en mujeres y las cajas mas amplias lo que indica mayor variabilidad en la edad de los casos reportados. En cuanto al estado de Guerrero muestran las edades promedio mas bajas y las cajas mas pequenas lo que indica que la mayor concentracion de casos confirmados son de jovenes.
```{r}
par(mar = c(5, 15, 4, 1))
boxplot(EDAD_ANOS ~ `DESCRIPCIÓN.x` + ENTIDAD_FEDERATIVA,
        main = "Distribución de Edad por Entidad Federativa y Sexo",
        xlab = "Edad (años)",
        ylab = "",
        data = media_edades_confirmados,
        horizontal = TRUE,
        las = 1,
        col = c("lightblue", "lightpink"),
        names = rep(c("H", "M"), 5),
        at = c(1, 2, 4, 5, 7, 8, 10, 11, 13, 14))

# Agregar etiquetas de los estados en el eje Y
axis(2, at = c(1.5, 4.5, 7.5, 10.5, 13.5),
     labels = sort(unique(media_edades_confirmados$ENTIDAD_FEDERATIVA)),
     las = 1, tick = FALSE, line = 1)
legend("bottomright", legend = c("Hombre", "Mujer"), fill = c("lightblue", "lightpink"), )
```

## Analisis grafico de densidad

```{r}
densityPlot(info_estados_dengue_confirmados$EDAD_ANOS ~ as.factor(info_estados_dengue_confirmados$ENTIDAD_FEDERATIVA),
            legend = list(title="Densidad Edad"))
```


Interpretación técnica
Forma general de las distribuciones
Todas las curvas presentan una forma asimétrica hacia la derecha (sesgo positivo), lo que indica que la mayoría de los casos se concentran en edades jóvenes, con una disminución progresiva del número de casos conforme aumenta la edad.
Esto sugiere que el dengue afecta principalmente a personas jóvenes, aunque también hay presencia de casos en adultos y adultos mayores, pero en menor proporción.
Comparación entre estados
Guerrero y Colima muestran los picos de densidad más altos alrededor de los 10 a 20 años, lo que indica una concentración más marcada de casos en adolescentes o adultos jóvenes.
Jalisco tiene una distribución más amplia con una segunda elevación hacia los 30–40 años, lo que refleja una mayor dispersión de edades afectadas.
Michoacán de Ocampo y Nayarit presentan curvas más suaves y distribuciones intermedias, con concentraciones también hacia edades jóvenes pero con presencia notable en edades adultas.
Dispersión
En todos los estados, el rango de edad de casos confirmados abarca desde niños pequeños hasta adultos mayores, aunque la mayor densidad se encuentra en menores de 30 años.

## Mayor cantidad de casos de cada estado y hacer grafico de densidad
```{r}
conteo_registros_municipio <- aggregate(info_estados_dengue_confirmados$ID_REGISTRO ~ info_estados_dengue_confirmados$ENTIDAD_FEDERATIVA + info_estados_dengue_confirmados$MUNICIPIO , FUN = length)
colnames(conteo_registros_municipio) <- c("Estado", "Municipio", "Registros")

maximos_por_estado <- do.call(rbind, by(conteo_registros_municipio, conteo_registros_municipio$Estado, function(df) {
  df[which.max(df$Registros),]
}))
rownames(maximos_por_estado) <- NULL
maximos_por_estado
info_municipios_max <- info_estados_dengue_confirmados[
  paste(info_estados_dengue_confirmados$ENTIDAD_FEDERATIVA, info_estados_dengue_confirmados$MUNICIPIO) %in%
  paste(maximos_por_estado$Estado, maximos_por_estado$Municipio),
]
table(info_municipios_max$ENTIDAD_FEDERATIVA)

# Filtrar datos por municipios con mas casos
# info_estados_dengue_confirmados[info_estados_dengue_confirmados$]

densityPlot(info_municipios_max$EDAD_ANOS ~ as.factor(info_municipios_max$ENTIDAD_FEDERATIVA),
            main = "Distribución de Edad en Municipios con Mayor Casos por Estado",
            xlab = "Edad (años)",
            legend = list(title = "ENTIDAD_FEDERATIVA"))
```


# Mostrar un grafico de barras, de cada estado, donde muestre la frecuencia de registro
# de nuevos casos de los meses enero a septiembre.
